<?xml version="1.0"?>
<pattern  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    
    <architecture>
        <component>
            <id>pubsubGE</id>
            <address>orion.lab.fi-ware.eu</address>
            <interface>
                <id>NSGI10</id>
                <url>http://orion.lab.fi-ware.eu:1026/NGSI10/queryContext</url>
            </interface>
            <interface>
                <id>NSGI10</id>
                <url>http://orion.lab.fi-ware.eu:1026/NGSI9/registerContext</url>
            </interface>
        </component>
    </architecture>
    
     <behaviour>
        <state>
          <label>A1</label>
          <type>triggerstart</type>
          <transition>    
                <to>A2</to>
                <message>
                    <url>http://orion.lab.fi-ware.eu:1026/NGSI9/registerContext</url>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>PSzRfoMrfAr5GswEKDCmg4pKSCjTbHrvru5CxklBZoRlSwK58hCFOnVhwsCpF3i1suwsR1tiDnO7_2OMP0I1Sw</value>
                        </header>
                    </headers>
                    <body><![CDATA[<registerContextRequest>
                               <contextRegistrationList>
                                 <contextRegistration>
                                   <entityIdList>
                                     <entityId type="Car" isPattern="false">
                                       <id>Hyundai_i30</id>
                                     </entityId>
                                   </entityIdList>
                                   <contextRegistrationAttributeList>
                                     <contextRegistrationAttribute>
                                       <name>speed</name>
                                       <type>mph</type>
                                       <contextValue>45</contextValue>
                                       <isDomain>false</isDomain>
                                     </contextRegistrationAttribute>
                                   </contextRegistrationAttributeList>
                                   <providingApplication>http://speed-sensor.mydomain.com:7777</providingApplication>
                                 </contextRegistration>
                               </contextRegistrationList>
                               <duration>PT1H</duration>
                               <registrationId></registrationId>
                             </registerContextRequest>]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A2</label>
          <type>normal</type>
            <transition>    
                <to>A31</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[name(/*)]</param>
                        <value>registerContextResponse</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A31</label>
          <type>trigger</type>
          <transition>    
                <to>A32</to>
                <message>
                    <url>http://orion.lab.fi-ware.eu:1026/NGSI9/discoverContextAvailability</url>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>PSzRfoMrfAr5GswEKDCmg4pKSCjTbHrvru5CxklBZoRlSwK58hCFOnVhwsCpF3i1suwsR1tiDnO7_2OMP0I1Sw</value>
                        </header>
                    </headers>
                    <body><![CDATA[<discoverContextAvailabilityRequest>
                           <entityIdList>
                             <entityId type="Car" isPattern="false">
                               <id>Hyundai_i30</id>
                             </entityId>
                           </entityIdList>
                           <attributeList>
                             <attribute>speed</attribute>
                           </attributeList>
                         </discoverContextAvailabilityRequest>]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A32</label>
          <type>normal</type>
            <transition>    
                <to>A3</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[name(/*)]</param>
                        <value>discoverContextAvailabilityResponse</value>
                    </equal>
                    <equal>
                        <param>Content[/updateContextResponse/contextResponseList/contextElementResponse/statusCode/code/text()]</param>
                        <value>200</value>
                    </equal>
                </guards>
              </transition>
        </state>
        
        <state>
          <label>A3</label>
          <type>trigger</type>
          <transition>    
                <to>A4</to>
                <message>
                    <url>http://orion.lab.fi-ware.eu:1026/NGSI10/updateContext</url>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>PSzRfoMrfAr5GswEKDCmg4pKSCjTbHrvru5CxklBZoRlSwK58hCFOnVhwsCpF3i1suwsR1tiDnO7_2OMP0I1Sw</value>
                        </header>
                    </headers>
                    <body><![CDATA[<updateContextRequest>
                              <contextElementList>
                                <contextElement>
                                  <entityId type="Car" isPattern="false">
                                    <id>Hyundai_i30</id>
                                  </entityId>
                                  <contextAttributeList>
                                    <contextAttribute>
                                      <name>speed</name>
                                      <type>mph</type>
                                      <contextValue>75</contextValue>
                                    </contextAttribute>
                                  </contextAttributeList>
                                </contextElement>
                              </contextElementList>
                              <updateAction>Update</updateAction>
                            </updateContextRequest>]]>
                    </body>
                </message>
              </transition>
        </state>
        <state>
          <label>A4</label>
          <type>normal</type>
            <transition>    
                <to>A5</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[name(/*)]</param>
                        <value>updateContextResponse</value>
                    </equal>
                    <equal>
                        <param>Content[/updateContextResponse/contextResponseList/contextElementResponse/statusCode/code/text()]</param>
                        <value>200</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A5</label>
          <type>trigger</type>
          <transition>    
                <to>A6</to>
                <message>
                    <url>component.pubsubGE.NSGI10</url>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>PSzRfoMrfAr5GswEKDCmg4pKSCjTbHrvru5CxklBZoRlSwK58hCFOnVhwsCpF3i1suwsR1tiDnO7_2OMP0I1Sw</value>
                        </header>
                    </headers>
                    <body><![CDATA[
                        <queryContextRequest>
                            <entityIdList>
                                <entityId type="Room" isPattern="true">
                                    <id>Room.*</id>  
                                </entityId>
                            </entityIdList>
                            <attributeList>
                                <attribute>temperature</attribute>
                            </attributeList>  
                        </queryContextRequest>]]>
                    </body>
                </message>
              </transition>
        </state>
        <state>
          <label>A6</label>
          <type>normal</type>
            <transition>    
                <to>A5</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[name(/*)]</param>
                        <value>queryContextResponse</value>
                    </equal>
                    <equal>
                        <param>Content[/queryContextResponse/contextAttributeList/contextAttribute/name</param>
                        <value>temperature</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
            <label>A7</label>
            <type>end</type>
        </state>
    </behaviour>
</pattern>
