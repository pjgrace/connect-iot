<?xml version="1.0"?>
<pattern xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:noNamespaceSchemaLocation ="Pattern.xsd">
    
    <patterndata>
        <data>
            <name>client_id</name>
            <value>572</value>
        </data>
        <data>
            <name>redirect_uri</name>
            <value>http://192.9.206.88:8193/interoperability</value>
        </data>
    </patterndata>
    
    
    <architecture>
        <component>
            <id>idmGE</id>
            <address>account.lab.fiware.org</address>
            <interface>
                <id>idmauthorise</id>
                <url>https://account.lab.fi-ware.org:443/oauth2</url>
            </interface>
        </component>
        <component>
            <id>callback</id>
            <address>192.9.206.88</address>
            <interface>
                <id>callback</id>
                <url>http://192.9.206.88:8192/interoperability</url>
            </interface>
        </component>
        <component>
            <id>idm_client</id>
            <address>192.9.206.88</address>
        </component>
    </architecture>
    
    <behaviour>
        <state>
          <label>AA1</label>
          <type>start</type>
          <transition>    
                <to>AA2</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.idm_client.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.to</param>
                        <value>component.idmGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.toInterface</param>
                        <value>component.idmGE.idmauthorise</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>GET</value>
                    </equal>
                    <equal>
                        <param>QUERY.response_type</param>
                        <value>code</value>
                    </equal>
                    <equal>
                        <param>QUERY.client_id</param>
                        <value>patterndata.client_id</value>
                    </equal>
                    <equal>
                        <param>QUERY.redirect_uri</param>
                        <value>patterndata.redirect_uri</value>
                    </equal>
                    <contains>
                        <param>MESSAGE</param>
                        <value>QUERY.state</value>
                    </contains>
                </guards>
              </transition>
        </state>
        <state>
          <label>AA2</label>
          <type>normal</type>
          <transition>    
                <to>A1</to>
                <guards>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.code</param>
                        <value>302</value>
                    </equal>
                </guards>
              </transition>
        </state>
         <state>
          <label>A1</label>
          <type>normal</type>
          <transition>    
                <to>A2</to>
                <guards>
                    <equal>
                        <param>HTTP.to</param>
                        <value>component.callback.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.toInterface</param>
                        <value>component.callback.callback</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>GET</value>
                    </equal>
                    <contains>
                        <param>MESSAGE</param>
                        <value>QUERY.code</value>
                    </contains>

                </guards>
              </transition>
        </state>
        <state>
          <label>A2</label>
          <type>normal</type>
            <transition>    
                <to>A3</to>
                <guards>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>POST</value>
                    </equal>
                    <contains>
                        <param>HTTP.Headers</param>
                        <value>HTTP.Authorization</value>
                    </contains>
                    <equal>
                        <param>HTTP.Content-Type</param>
                        <value>application/x-www-form-urlencoded</value>
                    </equal>
                    <equal>
                        <param>grant_type</param>
                        <value>authorization_code</value>
                    </equal>
                    <equal>
                        <param>redirect_uri</param>
                        <value>patterndata.redirect_uri</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A3</label>
          <type>normal</type>
            <transition>    
                <to>A4</to>
                <guards>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.code</param>
                        <value>200</value>
                    </equal>
                    <contains>
                        <param>Content</param>
                        <value>$.access_token</value>
                    </contains>
                </guards>
              </transition>
        </state>
        <state>
          <label>A4</label>
          <type>normal</type>
            <transition>    
                <to>A5</to>
                <guards>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.code</param>
                        <value>200</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A5</label>
          <type>end</type>
        </state>
    </behaviour>
</pattern>
