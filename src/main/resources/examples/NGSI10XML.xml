<?xml version="1.0"?>
<pattern  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    
    <patterndata>
        <data>
            <name>token</name>
            <value>**TOKEN**</value>
        </data>
    </patterndata>
    
    <architecture>
        <component>
            <id>pubsubGE</id>
            <address>**ADDRESS**</address>
            <interface>
                <id>NGSI10</id>
                <url>**URL**</url>
            </interface>
        </component>
    </architecture>
    
     <behaviour>
        <state>
          <label>A1</label>
          <type>triggerstart</type>
          <transition>    
                <to>A2</to>
                <message>
                    <url>component.pubsubGE.NGSI10</url>
                    <path>/updateContext</path>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>patterndata.token</value>
                        </header>
                    </headers>
                    <body><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
                        <updateContextRequest>
                          <contextElementList>
                            <contextElement>
                              <entityId type="Car" isPattern="false">
                                <id>Ford1</id>
                              </entityId>
                              <contextAttributeList>
                                <contextAttribute>
                                  <name>temperature</name>
                                  <type>centigrade</type>
                                  <contextValue>21</contextValue>
                                </contextAttribute>
                                <contextAttribute>
                                  <name>pressure</name>
                                  <type>mmHg</type>
                                  <contextValue>223</contextValue>
                                </contextAttribute>
                              </contextAttributeList>
                            </contextElement>
                          </contextElementList>
                          <updateAction>APPEND</updateAction>
                        </updateContextRequest>]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A2</label>
          <type>normal</type>
            <transition>    
                <to>A3</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[name(/*)]</param>
                        <value>updateContextResponse</value>
                    </equal>
                    <equal>
                        <param>Content[/updateContextResponse/contextResponseList/contextElementResponse/statusCode/code/text()]</param>
                        <value>200</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A3</label>
          <type>trigger</type>
          <transition>    
                <to>A4</to>
                <message>
                    <url>component.pubsubGE.NGSI10</url>
                    <path>/queryContext</path>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>patterndata.token</value>
                        </header>
                    </headers>
                    <body><![CDATA[<queryContextRequest>
                        <entityIdList>
                          <entityId type="Car" isPattern="false">
                            <id>Ford1</id>
                          </entityId>
                        </entityIdList>
                        <attributeList>
                          <attribute>temperature</attribute>
                        </attributeList>
                      </queryContextRequest>]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A4</label>
          <type>normal</type>
            <transition>    
                <to>A5</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[name(/*)]</param>
                        <value>queryContextResponse</value>
                    </equal>
                    <equal>
                        <param>Content[/queryContextResponse/contextResponseList/contextElementResponse/statusCode/code/text()]</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[/queryContextResponse/contextResponseList/contextElementResponse/contextElement/contextAttributeList/contextAttribute/contextValue/text()]</param>
                        <value>21</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A5</label>
          <type>trigger</type>
          <transition>    
                <to>A6</to>
                <message>
                    <url>component.pubsubGE.NGSI10</url>
                    <path>/updateContext</path>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>patterndata.token</value>
                        </header>
                    </headers>
                    <body><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
                        <updateContextRequest>
                          <contextElementList>
                            <contextElement>
                              <entityId type="Car" isPattern="false">
                                <id>Ford1</id>
                              </entityId>
                              <contextAttributeList>
                                <contextAttribute>
                                  <name>temperature</name>
                                  <type>centigrade</type>
                                  <contextValue>29</contextValue>
                                </contextAttribute>
                                <contextAttribute>
                                  <name>pressure</name>
                                  <type>mmHg</type>
                                  <contextValue>223</contextValue>
                                </contextAttribute>
                              </contextAttributeList>
                            </contextElement>
                          </contextElementList>
                          <updateAction>APPEND</updateAction>
                        </updateContextRequest>]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A6</label>
          <type>normal</type>
            <transition>    
                <to>A7</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[name(/*)]</param>
                        <value>updateContextResponse</value>
                    </equal>
                    <equal>
                        <param>Content[/updateContextResponse/contextResponseList/contextElementResponse/statusCode/code/text()]</param>
                        <value>200</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A7</label>
          <type>trigger</type>
          <transition>    
                <to>A8</to>
                <message>
                    <url>component.pubsubGE.NGSI10</url>
                    <path>/queryContext</path>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>patterndata.token</value>
                        </header>
                    </headers>
                    <body><![CDATA[<queryContextRequest>
                        <entityIdList>
                          <entityId type="Car" isPattern="false">
                            <id>Ford1</id>
                          </entityId>
                        </entityIdList>
                        <attributeList>
                          <attribute>temperature</attribute>
                        </attributeList>
                      </queryContextRequest>]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A8</label>
          <type>normal</type>
            <transition>    
                <to>A9</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[name(/*)]</param>
                        <value>queryContextResponse</value>
                    </equal>
                    <equal>
                        <param>Content[/queryContextResponse/contextResponseList/contextElementResponse/statusCode/code/text()]</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[/queryContextResponse/contextResponseList/contextElementResponse/contextElement/contextAttributeList/contextAttribute/contextValue/text()]</param>
                        <value>29</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A9</label>
          <type>trigger</type>
          <transition>    
                <to>A10</to>
                <message>
                    <url>component.pubsubGE.NGSI10</url>
                    <path>/queryContext</path>
                    <method>get</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>patterndata.token</value>
                        </header>
                    </headers>
                    <body><![CDATA[
                        <?xml version="1.0" encoding="UTF-8"?>
                            <queryContextRequest>
                              <entityIdList>
                                <entityId type="Car" isPattern="false">
                                  <id>Ford1</id>
                                </entityId>
                              </entityIdList>
                              <attributeList>
                                <attribute>temperature</attribute>
                              </attributeList>
                            </queryContextRequest>
                       ]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A10</label>
          <type>normal</type>
            <transition>    
                <to>A11</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>405</value>
                    </equal>
                </guards>
              </transition>
        </state>
        
        <state>
          <label>A11</label>
          <type>trigger</type>
          <transition>    
                <to>A12</to>
                <message>
                    <url>component.pubsubGE.NGSI10</url>
                    <path>/subscribeContext</path>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>patterndata.token</value>
                        </header>
                    </headers>
                    <body><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
                        <subscribeContextRequest>
                          <entityIdList>
                            <entityId type="Car" isPattern="false">
                              <id>Ford1</id>
                            </entityId>
                          </entityIdList>
                          <attributeList>
                            <attribute>temperature</attribute>
                          </attributeList>
                          <reference>http://localhost:1028/accumulate</reference>
                          <duration>P1M</duration>
                          <notifyConditions>
                            <notifyCondition>
                              <type>ONTIMEINTERVAL</type>
                              <condValueList>
                                <condValue>PT10S</condValue>
                              </condValueList>
                            </notifyCondition>
                          </notifyConditions>
                        </subscribeContextRequest>
                       ]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A12</label>
          <type>normal</type>
            <transition>    
                <to>A13</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[/subscribeContextResponse/subscribeResponse/duration/text()]</param>
                        <value>P1M</value>
                    </equal>
                </guards>
              </transition>
        </state>
        
        <state>
          <label>A13</label>
          <type>trigger</type>
          <transition>    
                <to>A14</to>
                <message>
                    <url>component.pubsubGE.NGSI10</url>
                    <path>/updateContextSubscription</path>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>patterndata.token</value>
                        </header>
                    </headers>
                    <body><![CDATA[<?xml version="1.0"?>
                            <updateContextSubscriptionRequest>
                              <subscriptionId>$$A12|content|/subscribeContextResponse/subscribeResponse/subscriptionId/text()$$</subscriptionId>
                              <notifyConditions>
                                <notifyCondition>
                                  <type>ONTIMEINTERVAL</type>
                                  <condValueList>
                                    <condValue>PT5S</condValue>
                                  </condValueList>
                                </notifyCondition>
                              </notifyConditions>
                            </updateContextSubscriptionRequest>
                       ]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A14</label>
          <type>normal</type>
            <transition>    
                <to>A15</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[/updateContextSubscriptionResponse/subscribeResponse/subscriptionId/text()]</param>
                        <value>$$A12|content|/subscribeContextResponse/subscribeResponse/subscriptionId/text()$$$$</value>
                    </equal>
                </guards>
              </transition>
        </state>
        
        <state>
          <label>A15</label>
          <type>trigger</type>
          <transition>    
                <to>A16</to>
                <message>
                    <url>component.pubsubGE.NGSI10</url>
                    <path>/unsubscribeContext</path>
                    <method>post</method>
                    <type>xml</type>
                    <headers>
                        <header>
                            <name>X-Auth-Token</name>
                            <value>patterndata.token</value>
                        </header>
                    </headers>
                    <body><![CDATA[<?xml version="1.0"?>
                        <unsubscribeContextRequest>
                          <subscriptionId>$$A12|content|/subscribeContextResponse/subscribeResponse/subscriptionId/text()$$</subscriptionId>
                        </unsubscribeContextRequest>
                       ]]>
                    </body>
                </message>
              </transition>
        </state>

        <state>
          <label>A16</label>
          <type>normal</type>
            <transition>    
                <to>A99</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                    <equal>
                        <param>Content[/unsubscribeContextResponse/statusCode/code]</param>
                        <value>200</value>
                    </equal>
                </guards>
              </transition>
        </state>
        
        <state>
            <label>A99</label>
            <type>end</type>
        </state>
    </behaviour>
</pattern>
