<?xml version="1.0"?>
<pattern xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:noNamespaceSchemaLocation ="Pattern.xsd">
    
    <architecture>
        <component>
            <id>pubsubGE</id>
            <address>orion.lab.fi-ware.eu</address>
            <interface>
                <id>NSGI10</id>
                <url>http://orion.lab.fi-ware.eu:1026/NGSI10</url>
            </interface>
        </component>
        <component>
            <id>ps_client</id>
            <address>127.0.0.1</address>
        </component>
    </architecture>
    
    <behaviour>
        <state>
          <label>A1</label>
          <type>start</type>
          <transition>    
                <to>A2</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.ps_client.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.to</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.toInterface</param>
                        <value>component.pubsubGE.NSGI10</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>POST</value>
                    </equal>
                    <equal>
                            <param>HTTP.Content-type</param>
                            <value>application/xml</value>
                    </equal>
                    <equal>
                        <param>Content[name(/*)]</param>
                        <value>queryContextRequest</value>
                    </equal>
                    <equal>
                        <param>Content[/queryContextRequest/attributeList/attribute]</param>
                        <value>temperature</value>
                    </equal>
                    <contains>
                        <param>HTTP.Headers</param>
                        <value>HTTP.X-auth-token</value>
                    </contains>
                </guards>
              </transition>
              <transition>    
                <to>A4</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.ps_client.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.to</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.toInterface</param>
                        <value>component.pubsubGE.NSGI10</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>POST</value>
                    </equal>
                    <equal>
                            <param>HTTP.Content-type</param>
                            <value>application/json</value>
                    </equal>
                    <equal>
                            <param>HTTP.Accept</param>
                            <value>application/json</value>
                    </equal>
                    <equal>
                        <param>HTTP.toInterface</param>
                        <value>component.pubsubGE.NSGI10</value>
                    </equal>
                    <equal>
                        <param>Content[$.entities[0].type]</param>
                        <value>Room</value>
                    </equal>
                    <contains>
                        <param>HTTP.Headers</param>
                        <value>HTTP.X-auth-token</value>
                    </contains>
                </guards>
              </transition>
        </state>
        <state>
          <label>A2</label>
          <type>normal</type>
            <transition>    
                <to>A3</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.to</param>
                        <value>component.ps_client.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A4</label>
          <type>normal</type>
            <transition>    
                <to>A3</to>
                <guards>
                    <equal>
                        <param>HTTP.from</param>
                        <value>component.pubsubGE.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.to</param>
                        <value>component.ps_client.address</value>
                    </equal>
                    <equal>
                        <param>HTTP.msg</param>
                        <value>REPLY</value>
                    </equal>
                    <equal>
                        <param>HTTP.Code</param>
                        <value>200</value>
                    </equal>
                </guards>
              </transition>
        </state>
        <state>
          <label>A3</label>
          <type>end</type>
        </state>
    </behaviour>
</pattern>
